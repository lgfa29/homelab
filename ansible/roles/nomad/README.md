# `nomad` Role

Installs and configures [HashiCorp Nomad](https://www.nomadproject.io/).

## Defaults

| Name                            | Type                                                     | Default            | Description                                                                                                                                                                                              |
| ------------------------------- | -------------------------------------------------------- | ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `nomad_version`                 | `string`                                                 | `""`               | Version of Nomad to install.                                                                                                                                                                             |
| `nomad_pkg_version`             | `string`                                                 | `"1"`              | Version of the Nomad Linux package to install.                                                                                                                                                           |
| `nomad_user`                    | `string`                                                 | `"root"`           | Operating system user to run the Nomad agent.                                                                                                                                                            |
| `nomad_group`                   | `string`                                                 | `"root"`           | Operating system user group to run the Nomad agent.                                                                                                                                                      |
| `nomad_agent_name`              | `string`                                                 | `""`               | The name of this Nomad agent in the region. Equivalent to the [`name`](https://developer.hashicorp.com/nomad/docs/configuration#name) Nomad configuration.                                               |
| `nomad_region`                  | `string`                                                 | `"global"`         | Nomad region this agent is running. Equivalent to the [`region`](https://developer.hashicorp.com/nomad/docs/configuration#region) Nomad configuration.                                                   |
| `nomad_datacenter`              | `string`                                                 | `"dc1"`            | Datacenter of the Nomad agent. Equivalent to the [`datacenter`](https://developer.hashicorp.com/nomad/docs/configuration#datacenter) Nomad configuration.                                                |
| `nomad_server_enabled`          | `bool`                                                   | `false`            | If `true`, the Nomad agent runs with server mode enabled. Equivalent to the [`server.enabled`](https://developer.hashicorp.com/nomad/docs/configuration/server#enabled) Nomad configuration.             |
| `nomad_server_bootstrap_expect` | `integer`                                                | `1`                | The number of servers expected in the Nomad region. Equivalent to the [`server.bootstrap_expect`](https://developer.hashicorp.com/nomad/docs/configuration/server#bootstrap_expect) Nomad configuration. |
| `nomad_server_server_join`      | `list(string)`                                           | `[]`               | List of strings used by servers to discover each other. Equivalent to the [`server.server_join`](https://developer.hashicorp.com/nomad/docs/configuration/server#server_join) Nomad configuration.       |
| `nomad_server_encrypt_key`      | `string`                                                 | `""`               | Secret key used to encrypt servers gossip traffic. Equivalent to the [`server.encrypt`](https://developer.hashicorp.com/nomad/docs/configuration/server#encrypt) Nomad configuration.                    |
| `nomad_client_enabled`          | `bool`                                                   | `false`            | If `true`, the Nomad agent runs with client mode enabled. Equivalent to the [`client.enabled`](https://developer.hashicorp.com/nomad/docs/configuration/client#enabled) Nomad configuration.             |
| `nomad_client_node_class`       | `string`                                                 | `""`               | Specifies an arbitrary string to group clients. Equivalent to the [`client.node_class`](https://developer.hashicorp.com/nomad/docs/configuration/client#node_class) Nomad configuration.                 |
| `nomad_client_server_join`      | `list(string)`                                           | `[]`               | List of strings used by the clients to discover servers. Equivalent to the [`client.server_join`](https://developer.hashicorp.com/nomad/docs/configuration/client#server_join) Nomad configuration.      |
| `nomad_client_meta`             | `map(string: string)`                                    | `{}`               | Key-value map to annotate the client with metadata. Equivalent to the [`client.meta`](https://developer.hashicorp.com/nomad/docs/configuration/client#meta) Nomad configuration.                         |
| `nomad_client_enable_raw_exec`  | `bool`                                                   | `false`            | If `true`, the `raw_exec` task driver is enabled in the client.                                                                                                                                          |
| `nomad_client_host_volumes`     | `list(map(name: string, path: string, read_only: bool))` | `{}`               | Map of Nomad host volumes to create and register in the client.                                                                                                                                          |
| `nomad_acl_enabled`             | `bool`                                                   | `true`             | If `true`, the ACL system is enabled. Equivalent to the [`acl.enabled`](https://developer.hashicorp.com/nomad/docs/configuration/acl#enabled) Nomad configuration.                                       |
| `nomad_tls_enabled`             | `bool`                                                   | `true`             | If `true`, mTLS is enabled for HTTP and RPC traffic.                                                                                                                                                     |
| `nomad_tls_ca_cert`             | `string`                                                 | `""`               | Contents of the mTLS CA certificate used by the Nomad agent.                                                                                                                                             |
| `nomad_tls_cert`                | `string`                                                 | `""`               | Contents of the mTLS certificate used by the Nomad agent.                                                                                                                                                |
| `nomad_tls_cert_key`            | `string`                                                 | `""`               | Contents of the mTLS certificate key used by the Nomad agent.                                                                                                                                            |
| `nomad_consul_address`          | `string`                                                 | `"127.0.0.1:8500"` | Address to use to connect to the Consul agent. Equivalent to the [`consul.address`](https://developer.hashicorp.com/nomad/docs/configuration/consul#address) Nomad configuration.                        |
| `nomad_consul_acl_token`        | `string`                                                 | `""`               | ACL token token to use to connect to the Consul agent. Equivalent to the [`consul.token`](https://developer.hashicorp.com/nomad/docs/configuration/consul#token) Nomad configuration.                    |
| `nomad_consul_use_ssl`          | `bool`                                                   | `true`             | If `true`, the Nomad agent uses mTLS to connect to Consul.                                                                                                                                               |
| `nomad_consul_ca_cert`          | `string`                                                 | `""`               | Contents of the mTLS CA certificate used by the Nomad agent to connect to Consul.                                                                                                                        |
| `nomad_consul_cert`             | `string`                                                 | `""`               | Contents of the mTLS certificate used by the Nomad agent to connect to Consul.                                                                                                                           |
| `nomad_consul_cert_key`         | `string`                                                 | `""`               | Contents of the mTLS certificate key used by the Nomad agent to connect to Consul.                                                                                                                       |
| `nomad_consul_tags`             | `list(string)`                                           | `[]`               | Additional tags to add to the Nomad service registered in Consul. Equivalent to the [`consul.tags`](https://developer.hashicorp.com/nomad/docs/configuration/consul#tags) Nomad configuration.           |
| `nomad_extra_config_files`      | `list(map(src: string, dest: string))`                   | `{}`               | Additional templates that are rendered as Nomad configuration files.                                                                                                                                     |
